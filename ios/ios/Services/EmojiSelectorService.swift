//
//  EmojiSelectorService.swift
//  ios
//

import Foundation

class EmojiSelectorService {
    static let shared = EmojiSelectorService()

    private init() {}

    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨çµµæ–‡å­—ã®ãƒãƒƒãƒ”ãƒ³ã‚°
    private let emojiMappings: [String: String] = [
        // å­¦ç¿’ãƒ»å‹‰å¼·é–¢é€£
        "ãƒ¬ãƒãƒ¼ãƒˆ": "ğŸ“",
        "èª²é¡Œ": "ğŸ“š",
        "å‹‰å¼·": "ğŸ“–",
        "å®¿é¡Œ": "âœï¸",
        "è©¦é¨“": "ğŸ“",
        "ãƒ†ã‚¹ãƒˆ": "ğŸ“",
        "è«–æ–‡": "ğŸ“„",
        "èª­æ›¸": "ğŸ“š",
        "å­¦ç¿’": "ğŸ“–",

        // ä»•äº‹é–¢é€£
        "ä¼šè­°": "ğŸ’¼",
        "ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°": "ğŸ’¼",
        "ãƒ—ãƒ¬ã‚¼ãƒ³": "ğŸ“Š",
        "è³‡æ–™": "ğŸ“‘",
        "ä»•äº‹": "ğŸ’¼",
        "ãƒ¡ãƒ¼ãƒ«": "ğŸ“§",
        "é›»è©±": "ğŸ“",
        "æ‰“ã¡åˆã‚ã›": "ğŸ¤",

        // è²·ã„ç‰©ãƒ»ç”Ÿæ´»
        "è²·ã„ç‰©": "ğŸ›’",
        "ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°": "ğŸ›ï¸",
        "é£Ÿæ": "ğŸ›’",
        "æ–™ç†": "ğŸ³",
        "æƒé™¤": "ğŸ§¹",
        "æ´—æ¿¯": "ğŸ‘•",
        "ç‰‡ä»˜ã‘": "ğŸ§¹",

        // å¥åº·ãƒ»é‹å‹•
        "é‹å‹•": "ğŸƒ",
        "ã‚¸ãƒ ": "ğŸ’ª",
        "ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°": "ğŸƒ",
        "ãƒ¨ã‚¬": "ğŸ§˜",
        "ã‚¹ãƒˆãƒ¬ãƒƒãƒ": "ğŸ¤¸",
        "æ•£æ­©": "ğŸš¶",
        "ç—…é™¢": "ğŸ¥",
        "è–¬": "ğŸ’Š",

        // ã‚¨ãƒ³ã‚¿ãƒ¡ãƒ»è¶£å‘³
        "æ˜ ç”»": "ğŸ¬",
        "éŸ³æ¥½": "ğŸµ",
        "ã‚²ãƒ¼ãƒ ": "ğŸ®",
        "æ—…è¡Œ": "âœˆï¸",
        "å†™çœŸ": "ğŸ“·",
        "çµµ": "ğŸ¨",
        "ã‚¢ãƒ¼ãƒˆ": "ğŸ¨",

        // äºˆå®šãƒ»ã‚¤ãƒ™ãƒ³ãƒˆ
        "èª•ç”Ÿæ—¥": "ğŸ‚",
        "ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼": "ğŸ‰",
        "ã‚¤ãƒ™ãƒ³ãƒˆ": "ğŸª",
        "äºˆç´„": "ğŸ“…",
        "ã‚¢ãƒã‚¤ãƒ³ãƒˆ": "ğŸ“…",
        "ç· åˆ‡": "â°",
        "æœŸé™": "â°",

        // äººé–“é–¢ä¿‚
        "ãƒ‡ãƒ¼ãƒˆ": "ğŸ’‘",
        "å‹é”": "ğŸ‘¥",
        "å®¶æ—": "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",
        "é£²ã¿ä¼š": "ğŸ»",

        // ãã®ä»–
        "æ”¯æ‰•ã„": "ğŸ’°",
        "éŠ€è¡Œ": "ğŸ¦",
        "æ‰‹ç¶šã": "ğŸ“‹",
        "ç”³è«‹": "ğŸ“‹",
        "è»Š": "ğŸš—",
        "ä¿®ç†": "ğŸ”§",
        "é…é”": "ğŸ“¦",
        "è·ç‰©": "ğŸ“¦"
    ]

    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®çµµæ–‡å­—ï¼ˆãƒãƒƒãƒã™ã‚‹ã‚‚ã®ãŒãªã„å ´åˆï¼‰
    private let defaultEmojis = ["ğŸ“Œ", "âœ…", "â­", "ğŸ’¡", "ğŸ¯"]

    /// ã‚¿ã‚¹ã‚¯ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰æœ€é©ãªçµµæ–‡å­—ã‚’é¸æŠ
    func selectEmoji(for taskText: String) -> String {
        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°
        for (keyword, emoji) in emojiMappings {
            if taskText.contains(keyword) {
                return emoji
            }
        }

        // ãƒãƒƒãƒã™ã‚‹ã‚‚ã®ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
        return defaultEmojis.randomElement() ?? "ğŸ“Œ"
    }

    /// ã‚¿ã‚¹ã‚¯ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰è¤‡æ•°ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«åŸºã¥ã„ã¦çµµæ–‡å­—ã‚’é¸æŠï¼ˆå„ªå…ˆåº¦ä»˜ãï¼‰
    func selectEmojiWithPriority(for taskText: String) -> String {
        // å„ªå…ˆåº¦ã®é«˜ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰é †ã«ãƒã‚§ãƒƒã‚¯
        let priorityKeywords = ["ç· åˆ‡", "æœŸé™", "ç·Šæ€¥", "é‡è¦", "æ€¥ã"]

        for keyword in priorityKeywords {
            if taskText.contains(keyword) {
                return emojiMappings[keyword] ?? "â°"
            }
        }

        // é€šå¸¸ã®ãƒãƒƒãƒãƒ³ã‚°
        return selectEmoji(for: taskText)
    }
}
